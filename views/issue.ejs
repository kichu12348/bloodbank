<%- include('partials/header') %>
<%- include('partials/nav') %>

<main class="max-w-2xl mx-auto px-4 py-6">
  <h1 class="text-2xl font-semibold mb-4">Issue Blood</h1>

  <% if (error) { %>
    <div class="mb-4 p-3 rounded bg-red-100 text-red-800"><%= error %></div>
  <% } %>

  <form action="/inventory/issue" method="POST" class="space-y-4 bg-white p-4 border rounded shadow-sm">
    <div>
      <label class="block text-sm font-medium mb-1">Select Bag</label>
      <select name="bag_id" class="w-full border rounded px-3 py-2" required>
        <% if (bags && bags.length) { %>
          <% bags.forEach(b => { %>
            <option value="<%= b.bag_id %>">#<%= b.bag_id %> - <%= b.blood_group %> (donated: <%= new Date(b.donation_date).toISOString().slice(0,10) %>, expiry: <%= new Date(b.expiry_date).toISOString().slice(0,10) %>)</option>
          <% }) %>
        <% } else { %>
          <option value="">No available bags</option>
        <% } %>
      </select>
    </div>
    <div class="flex gap-2">
      <button class="px-4 py-2 bg-amber-600 text-white rounded hover:bg-amber-700" <%= (!bags || !bags.length) ? 'disabled' : '' %>>Issue</button>
      <a href="/inventory" class="px-4 py-2 bg-gray-200 text-gray-800 rounded hover:bg-gray-300">Cancel</a>
    </div>
  </form>
</main>

<%- include('partials/footer') %>
